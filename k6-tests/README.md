# K6 부하 테스트 가이드

## 📁 디렉토리 구조

```
k6-tests/
├── scenarios/          # 테스트 시나리오 스크립트
│   ├── balance/       # 포인트 관련 테스트
│   ├── order/         # 주문 관련 테스트
│   └── integrated/    # 통합 시나리오 테스트
├── utils/             # 공통 유틸리티
│   └── config.js      # 설정 관리
└── data/              # 테스트 데이터
    └── users.json     # 테스트 사용자 데이터
```

## 🎯 부하 테스트 개념 정리

### 1. **Load Test (부하 테스트)**
- **목적**: 예상되는 일반적인 트래픽 수준에서 시스템의 동작 확인
- **특징**: 점진적으로 부하를 증가시켜 시스템의 응답 시간과 처리량 측정
- **예시**: 평상시 동시 사용자 100명, 분당 1000개 요청 처리

### 2. **Stress Test (스트레스 테스트)**
- **목적**: 시스템의 한계점 파악 및 장애 시나리오 대응 확인
- **특징**: 부하를 지속적으로 증가시켜 시스템이 언제 실패하는지 확인
- **예시**: 동시 사용자를 계속 증가시켜 시스템 한계 확인

### 3. **Peak Test (피크 테스트)**
- **목적**: 갑작스러운 트래픽 급증 상황 대응 능력 확인
- **특징**: 짧은 시간 내 급격한 부하 증가/감소 시뮬레이션
- **예시**: 이벤트 오픈 시 갑작스런 트래픽 폭증

### 4. **Endurance Test (내구성 테스트)**
- **목적**: 장시간 운영 시 시스템 안정성 확인
- **특징**: 일정한 부하를 장시간 유지하여 메모리 누수 등 확인
- **예시**: 24시간 동안 일정 수준의 부하 유지

## 📊 주요 성능 지표

### TPS (Transactions Per Second)
- 초당 처리 가능한 트랜잭션 수
- 시스템의 처리 능력을 나타내는 핵심 지표
- **높다고 무조건 좋은 것은 아님** - 응답 시간과 에러율도 함께 고려 필요

### Response Time
- 요청부터 응답까지 걸리는 시간
- P50, P95, P99 등 백분위수로 분석
- 사용자 경험과 직결되는 중요 지표

### Error Rate
- 전체 요청 중 실패한 요청의 비율
- 부하 증가에 따른 에러율 변화 모니터링 중요

## 🚨 병목 포인트 예측

### 이커머스 시스템의 주요 병목 지점

1. **데이터베이스 락 경합**
   - 재고 차감 시 동시성 제어
   - 포인트 차감/충전 시 트랜잭션 경합
   - 쿠폰 발급 시 수량 제한 처리

2. **외부 API 호출**
   - 결제 시스템 연동
   - 알림 서비스 호출

3. **캐시 미스**
   - 인기 상품 조회 시 캐시 미스
   - 세션 관리 부하

4. **Deadlock 가능성**
   - 주문-재고-포인트 동시 처리 시
   - 여러 테이블에 대한 복잡한 트랜잭션

## 🔧 K6 설치 및 실행

### 설치
```bash
# MacOS
brew install k6

# Docker
docker pull grafana/k6
```

### 실행 방법
```bash
# 로컬 실행
k6 run scenarios/balance/charge-load-test.js

# Docker 실행
docker run -i grafana/k6 run - <scenarios/balance/charge-load-test.js

# 결과 출력 형식 지정
k6 run --out json=results.json scenarios/balance/charge-load-test.js
```

## 📈 테스트 시나리오별 TPS 목표

| API | Load Test | Stress Test | Peak Test |
|-----|-----------|-------------|-----------|
| 포인트 충전 | 50 TPS | 200 TPS | 500 TPS |
| 포인트 사용 | 100 TPS | 400 TPS | 1000 TPS |
| 상품 조회 | 200 TPS | 800 TPS | 2000 TPS |
| 주문 생성 | 30 TPS | 120 TPS | 300 TPS |
| 인기 상품 조회 | 100 TPS | 400 TPS | 1000 TPS |

## 💡 퀴즈 답변

### Q: Stress Test와 Load Test의 차이?
**A**: 
- **Load Test**: 예상되는 정상 부하에서 시스템 성능 검증
- **Stress Test**: 한계점을 넘어서는 부하를 가해 시스템 붕괴 지점과 복구 능력 확인

### Q: TPS가 높으면 무조건 좋은가?
**A**: 아니다. TPS가 높아도:
- Response Time이 길면 사용자 경험이 나빠짐
- Error Rate가 높으면 실제 처리된 요청이 적음
- 리소스 사용률이 과도하면 시스템 불안정
- **균형잡힌 성능 지표 관리가 중요**