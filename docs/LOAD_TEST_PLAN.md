# 이커머스 시스템 부하 테스트 계획서

## 1. 테스트 개요

### 1.1 목적
- **성능 검증**: 동시 사용자 증가 시 시스템 응답 성능 측정
- **병목 구간 식별**: 트래픽 증가 시 발생하는 성능 저하 지점 파악
- **안정성 확인**: 높은 부하 상황에서 시스템 안정성 검증
- **용량 계획**: 적절한 서버 리소스 및 배포 스펙 도출

### 1.2 테스트 대상 시스템
- **애플리케이션**: Spring Boot 기반 이커머스 API
- **데이터베이스**: MySQL 8.0
- **캐시**: Redis 7.0
- **메시징**: Apache Kafka
- **모니터링**: Grafana + InfluxDB

### 1.3 테스트 환경
```
- CPU: 제한 없음 (로컬 개발 환경)
- Memory: 제한 없음 (로컬 개발 환경)
- Network: localhost
- OS: macOS/Linux
```

## 2. 테스트 시나리오

### 2.1 핵심 비즈니스 로직 기반 시나리오

#### 시나리오 1: 포인트 충전 (Balance Charging)
**목적**: 사용자 포인트 충전 API의 동시성 처리 능력 검증

**테스트 케이스**:
- **Load Test**: 50명 동시 사용자, 2분간 지속
- **Stress Test**: 100명 → 200명 점진적 증가, 3분간 지속

**성능 목표**:
- 응답시간 P95 < 500ms
- 처리량 > 50 TPS
- 에러율 < 1%

#### 시나리오 2: 주문 처리 (Order Processing)
**목적**: 재고 차감을 포함한 주문 처리의 동시성 안전성 검증

**테스트 케이스**:
- **Concurrency Test**: 25명 동시 사용자, 1분간 지속
- **Race Condition Test**: 동일 상품 대상 동시 주문 처리

**성능 목표**:
- 응답시간 P95 < 1000ms
- 처리량 > 30 TPS  
- 재고 정합성 100% 유지

#### 시나리오 3: 선착순 쿠폰 발급 (FCFS Coupon Issuance)
**목적**: 제한된 쿠폰 수량 대비 대량 요청 시 동시성 처리 검증

**테스트 케이스**:
- **FCFS Test**: 1000명이 100장 제한 쿠폰에 대해 동시 요청
- **Race Condition Test**: 동일 쿠폰 대상 동시 발급 요청

**성능 목표**:
- 응답시간 P95 < 800ms
- 쿠폰 발급 정확성 100%
- 중복 발급 0건

#### 시나리오 4: E2E 쇼핑 시나리오 (End-to-End Shopping)
**목적**: 실제 사용자 쇼핑 플로우의 전체적인 성능 검증

**테스트 플로우**:
1. 사용자 등록/로그인
2. 인기 상품 조회
3. 포인트 충전
4. 쿠폰 발급
5. 상품 주문
6. 주문 내역 조회

**성능 목표**:
- 전체 플로우 완료 시간 < 10초
- 각 단계별 성공률 > 95%

#### 시나리오 5: 통합 동시성 테스트 (Concurrent Operations)
**목적**: 다양한 기능이 동시에 실행될 때의 시스템 안정성 검증

**동시 실행 작업**:
- 포인트 충전
- 주문 처리
- 쿠폰 발급
- 상품 조회

## 3. 성능 메트릭

### 3.1 응답시간 (Response Time)
- **평균 응답시간** (Mean)
- **P95 응답시간** (95th Percentile)
- **P99 응답시간** (99th Percentile)
- **최대 응답시간** (Max)

### 3.2 처리량 (Throughput)
- **초당 요청 수** (RPS: Requests Per Second)
- **초당 트랜잭션 수** (TPS: Transactions Per Second)

### 3.3 에러율 (Error Rate)
- **HTTP 4xx 에러율**
- **HTTP 5xx 에러율**
- **타임아웃 에러율**
- **비즈니스 로직 에러율**

### 3.4 시스템 리소스
- **CPU 사용률**
- **메모리 사용률**
- **네트워크 I/O**
- **데이터베이스 커넥션 풀**

### 3.5 비즈니스 메트릭
- **성공한 주문 수**
- **실패한 주문 수**
- **재고 정합성 검증**
- **포인트 잔액 정합성 검증**

## 4. 테스트 도구 및 환경

### 4.1 부하 생성 도구
- **K6**: 주 부하 테스트 도구
- **시나리오 기반 스크립트**: JavaScript로 작성
- **동적 데이터 생성**: 랜덤 사용자/상품 데이터

### 4.2 모니터링 도구
- **Grafana**: 실시간 성능 지표 대시보드
- **InfluxDB**: 시계열 데이터 저장
- **Spring Boot Actuator**: 애플리케이션 메트릭

### 4.3 테스트 스크립트 구성
```
k6-tests/
├── scenarios/
│   ├── balance/
│   │   ├── charge-load-test.js
│   │   └── charge-stress-test.js
│   ├── order/
│   │   ├── order-load-test.js
│   │   └── order-concurrency-test.js
│   ├── coupon/
│   │   ├── coupon-fcfs-test.js
│   │   └── coupon-race-condition-test.js
│   └── integrated/
│       ├── e2e-shopping-scenario.js
│       └── concurrent-operations-test.js
```

## 5. Docker 리소스 최적화 테스트

### 5.1 테스트 시나리오
다양한 Docker 컨테이너 리소스 설정으로 애플리케이션 실행하여 최적 스펙 도출

#### 5.1.1 CPU 제한 테스트
```yaml
# docker-compose.override.yml 예시
services:
  app:
    deploy:
      resources:
        limits:
          cpus: '0.5'    # 0.5 CPU
          cpus: '1.0'    # 1 CPU  
          cpus: '2.0'    # 2 CPU
```

#### 5.1.2 메모리 제한 테스트  
```yaml
services:
  app:
    deploy:
      resources:
        limits:
          memory: 512M   # 512MB
          memory: 1G     # 1GB
          memory: 2G     # 2GB
```

### 5.2 성능 비교 매트릭스
| CPU | Memory | RPS | P95 Latency | Error Rate | 비고 |
|-----|--------|-----|-------------|------------|------|
| 0.5 | 512M   | ?   | ?           | ?          | 최소 스펙 |
| 1.0 | 1G     | ?   | ?           | ?          | 기본 스펙 |
| 2.0 | 2G     | ?   | ?           | ?          | 권장 스펙 |

## 6. 테스트 실행 계획

### 6.1 테스트 순서
1. **환경 준비**: Docker Compose로 인프라 실행
2. **단위 테스트**: 각 시나리오별 개별 실행
3. **통합 테스트**: 전체 시나리오 순차 실행
4. **리소스 최적화 테스트**: Docker 리소스 조정하며 반복 테스트
5. **결과 분석**: 성능 지표 분석 및 병목 지점 식별

### 6.2 테스트 자동화
- `start-and-test.sh`: 전체 환경 구성 및 테스트 실행 자동화
- 각 테스트 간 재고 초기화를 위한 애플리케이션 재시작 로직 포함

### 6.3 결과 수집
- Grafana 대시보드를 통한 실시간 모니터링
- K6 HTML 리포트 생성
- InfluxDB 내 성능 데이터 영구 보관

## 7. 성공 기준

### 7.1 기능적 요구사항
- [ ] 모든 API가 정상 동작 (HTTP 200 응답)
- [ ] 재고 정합성 100% 유지
- [ ] 포인트 잔액 정합성 100% 유지
- [ ] 중복 쿠폰 발급 0건

### 7.2 비기능적 요구사항
- [ ] 응답시간 P95 < 1초 (모든 API)
- [ ] 에러율 < 5% (전체 요청)
- [ ] 처리량 > 100 TPS (전체 시스템)
- [ ] 시스템 안정성 유지 (OOM, 크래시 없음)

## 8. 위험 요소 및 대응 방안

### 8.1 잠재적 위험
- **데이터베이스 커넥션 풀 고갈**
- **메모리 부족으로 인한 OOM**
- **동시성 처리 미흡으로 인한 데이터 정합성 오류**
- **캐시 성능 저하**

### 8.2 대응 방안
- 커넥션 풀 설정 모니터링 및 조정
- JVM 힙 메모리 설정 최적화
- 동시성 제어 로직 검증 강화
- Redis 성능 모니터링 및 최적화

---

**작성일**: 2025-09-12  
**작성자**: 이커머스 시스템 개발팀  
**문서 버전**: v1.0