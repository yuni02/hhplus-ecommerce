`ProductRankingEventHandler`ê°€ í˜¸ì¶œë˜ëŠ” ê³³ê³¼ ì–´ë…¸í…Œì´ì…˜ì— ëŒ€í•´ ì„¤ëª…ë“œë¦¬ê² ìŠµë‹ˆë‹¤.

## ğŸ” ProductRankingEventHandler í˜¸ì¶œ íë¦„

### 1. **ì´ë²¤íŠ¸ ë°œí–‰ ìœ„ì¹˜**

Search files...
## ğŸ“‹ ProductRankingEventHandler í˜¸ì¶œ íë¦„ê³¼ ì–´ë…¸í…Œì´ì…˜ ì„¤ëª…

### 1. **ì´ë²¤íŠ¸ ë°œí–‰ ìœ„ì¹˜**

`ProductRankingEventHandler`ëŠ” **ì£¼ë¬¸ ìƒì„± ì‹œ** í˜¸ì¶œë©ë‹ˆë‹¤:

```java
// CreateOrderService.java - 230-233ì¤„
// ìƒí’ˆ ë­í‚¹ ì—…ë°ì´íŠ¸ ì´ë²¤íŠ¸ ë°œí–‰ (íŠ¸ëœì­ì…˜ ì™„ë£Œ í›„ ë¹„ë™ê¸° ì²˜ë¦¬)
for (OrderItem item : orderItems) {
    eventPublisher.publishEvent(new ProductRankingUpdateEvent(this, item.getProductId(), item.getQuantity()));
}
```

### 2. **í˜¸ì¶œ íë¦„**

```mermaid
sequenceDiagram
    participant Client as í´ë¼ì´ì–¸íŠ¸
    participant OrderService as CreateOrderService
    participant EventPublisher as ApplicationEventPublisher
    participant EventHandler as ProductRankingEventHandler
    participant RedisService as RedisProductRankingService
    participant Redis as Redis

    Client->>OrderService: ì£¼ë¬¸ ìƒì„± ìš”ì²­
    OrderService->>OrderService: í•µì‹¬ ì£¼ë¬¸ ë¡œì§ ì²˜ë¦¬ (ì¬ê³ , ì”ì•¡, ì¿ í°)
    OrderService->>EventPublisher: ProductRankingUpdateEvent ë°œí–‰
    EventPublisher-->>OrderService: ì´ë²¤íŠ¸ ë°œí–‰ ì™„ë£Œ
    OrderService-->>Client: ì£¼ë¬¸ ì™„ë£Œ ì‘ë‹µ (ì¦‰ì‹œ ë°˜í™˜)
    
    Note over EventHandler: íŠ¸ëœì­ì…˜ ì™„ë£Œ í›„ ë¹„ë™ê¸° ì‹¤í–‰
    EventPublisher->>EventHandler: handleProductRankingUpdate() í˜¸ì¶œ
    EventHandler->>RedisService: updateProductRanking() í˜¸ì¶œ
    RedisService->>Redis: Redis ZSet ì—…ë°ì´íŠ¸
    Redis-->>RedisService: ì—…ë°ì´íŠ¸ ì™„ë£Œ
    RedisService-->>EventHandler: ì²˜ë¦¬ ì™„ë£Œ
    EventHandler-->>EventPublisher: í•¸ë“¤ëŸ¬ ì™„ë£Œ
```

### 3. **ì–´ë…¸í…Œì´ì…˜ ì„¤ëª…**

#### `@Async("productRankingExecutor")`
- **ëª©ì **: ë¹„ë™ê¸° ì‹¤í–‰ì„ ìœ„í•œ ìŠ¤ë ˆë“œ í’€ ì§€ì •
- **ìŠ¤ë ˆë“œ í’€**: `productRankingExecutor` (Redis ì‘ì—… ì „ìš©)
- **ì„¤ì •**: 
  - ê¸°ë³¸ ìŠ¤ë ˆë“œ: 3ê°œ
  - ìµœëŒ€ ìŠ¤ë ˆë“œ: 10ê°œ
  - ëŒ€ê¸°ì—´: 50ê°œ
  - ìŠ¤ë ˆë“œëª…: `product-ranking-`

#### `@TransactionalEventListener(phase = TransactionPhase.AFTER_COMMIT)`
- **ëª©ì **: íŠ¸ëœì­ì…˜ ì™„ë£Œ í›„ ì´ë²¤íŠ¸ ì²˜ë¦¬
- **ì‹¤í–‰ ì‹œì **: `AFTER_COMMIT` - íŠ¸ëœì­ì…˜ì´ ì„±ê³µì ìœ¼ë¡œ ì»¤ë°‹ëœ í›„
- **ì¥ì **: 
  - ë©”ì¸ íŠ¸ëœì­ì…˜ì— ì˜í–¥ ì—†ìŒ
  - ì‹¤íŒ¨í•´ë„ ì£¼ë¬¸ì€ ì„±ê³µ
  - ë°ì´í„° ì¼ê´€ì„± ë³´ì¥

### 4. **ì‹¤í–‰ ì‹œì ê³¼ ì¥ì **

#### **ì‹¤í–‰ ì‹œì **
```java
@Transactional
public CreateOrderResult createOrder(CreateOrderCommand command) {
    // 1. í•µì‹¬ ì£¼ë¬¸ ë¡œì§ (ë™ê¸° ì²˜ë¦¬)
    Order savedOrder = processOrderLogic(command);
    
    // 2. ì´ë²¤íŠ¸ ë°œí–‰ (íŠ¸ëœì­ì…˜ ë‚´ì—ì„œ ë°œí–‰ë§Œ)
    eventPublisher.publishEvent(new ProductRankingUpdateEvent(...));
    
    // 3. ì¦‰ì‹œ ì‘ë‹µ ë°˜í™˜ (ì‚¬ìš©ì ëŒ€ê¸° ì—†ìŒ)
    return result;
}

// 4. íŠ¸ëœì­ì…˜ ì™„ë£Œ í›„ ë¹„ë™ê¸°ë¡œ ì‹¤í–‰
@TransactionalEventListener(phase = TransactionPhase.AFTER_COMMIT)
public void handleProductRankingUpdate(ProductRankingUpdateEvent event) {
    // Redis ë­í‚¹ ì—…ë°ì´íŠ¸ (ì‹¤íŒ¨í•´ë„ ì£¼ë¬¸ì— ì˜í–¥ ì—†ìŒ)
}
```

#### **í•µì‹¬ ì¥ì **
1. **ì‘ë‹µ ì‹œê°„ ê°œì„ **: ì£¼ë¬¸ ìƒì„±ì€ 500ms, ë­í‚¹ ì—…ë°ì´íŠ¸ëŠ” ë¹„ë™ê¸°
2. **ì¥ì•  ê²©ë¦¬**: Redis ì¥ì• ê°€ ì£¼ë¬¸ì— ì˜í–¥ ì—†ìŒ
3. **í™•ì¥ì„±**: ë­í‚¹ ì—…ë°ì´íŠ¸ëŠ” ë³„ë„ ìŠ¤ë ˆë“œ í’€ì—ì„œ ì²˜ë¦¬
4. **ì¼ê´€ì„±**: íŠ¸ëœì­ì…˜ ì™„ë£Œ í›„ ì‹¤í–‰ìœ¼ë¡œ ë°ì´í„° ì¼ê´€ì„± ë³´ì¥

### 5. **ìŠ¤ë ˆë“œ í’€ ì„¤ì •**

```java
@Bean("productRankingExecutor")
public Executor productRankingExecutor() {
    ThreadPoolTaskExecutor executor = new ThreadPoolTaskExecutor();
    executor.setCorePoolSize(3);           // ê¸°ë³¸ ìŠ¤ë ˆë“œ ìˆ˜
    executor.setMaxPoolSize(10);           // ìµœëŒ€ ìŠ¤ë ˆë“œ ìˆ˜
    executor.setQueueCapacity(50);         // ëŒ€ê¸°ì—´ í¬ê¸°
    executor.setThreadNamePrefix("product-ranking-");
    return executor;
}
```

ì´ë ‡ê²Œ ì„¤ê³„í•¨ìœ¼ë¡œì¨ **í•µì‹¬ ì£¼ë¬¸ ë¡œì§ì€ ë¹ ë¥´ê²Œ ì²˜ë¦¬**í•˜ê³ , **ë¶€ê°€ ë¡œì§(ë­í‚¹ ì—…ë°ì´íŠ¸)ì€ ë¹„ë™ê¸°ë¡œ ì²˜ë¦¬**í•˜ì—¬ ì‚¬ìš©ì ê²½í—˜ì„ í¬ê²Œ ê°œì„ í–ˆìŠµë‹ˆë‹¤.